name: 生成 Sitemap

# GitHub Actiion DuckDuckStudio/Sitemap_Creator 示例工作流
# https://github.com/marketplace/actions/sitemap-creator-stable

on:
  push:
    branches:
      - main
      # 当 main 分支上有新推送且以下文件被更改时
    paths:
      - '**/*.html'
      - '**/*.md'
      - '.github/workflows/generate-sitemap.yml'
  workflow_dispatch: # 手动运行

jobs:
  generate_sitemap:
    runs-on: ubuntu-latest

    steps:
      - name: 更新网站地图
        uses: DuckDuckStudio/Sitemap_Creator@1.0.0
        with:
          location: "docs/sitemap.xml"
          basic_link: "https://duckduckstudio.github.io/Articles/#" # docsify 部署的
          file_type: "html,md" # 默认值也是这个，爱加不加
          ignore_file: "_Footer.md,404.html,某鸭的文章页面模板.html,营销号"
          website_path: "docs"
          base_branch: main # 默认值也是这个，爱加不加
          debug: true # 启用调试输出

      - name: 启用自动合并 (压缩) # 此步骤是我另外手动加的，后续可能会将其加入为新参数
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          sleep 10 # 等 PR 创建了再查找
          # 获取前面创建的 PR 编号，确保 PR 名包含 "Auto update sitemap"
          PR_NUMBER=$(gh pr list --limit 1 --search "Auto update sitemap" --json number | jq -r '.[0].number')
          gh pr merge $PR_NUMBER --squash --auto
          gh pr comment $PR_NUMBER --body "这看起来是更新网站地图的 PR，已自动启用自动合并。👍"
          gh pr edit $PR_NUMBER --add-label "DEV-已启用自动合并,工作流,DEV-开发分支合并" # 此处按照你自己仓库的标签来