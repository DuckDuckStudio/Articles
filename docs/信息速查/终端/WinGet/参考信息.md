# WinGet 的一些参考信息

> 本文编写与 2025 年 6 月 15 日

## CLI
### 尝试更新源失败 (winget) / 0x80070005 / 拒绝访问
#### 问题示例
```powershell
[Powered by 虚空终端] PS D:\Duckhome\CodeDebug> winget search DuckStudio
尝试更新源失败： winget
搜索源时失败;结果将不包括在内： winget
找不到与输入条件匹配的程序包。
```

```powershell
[Powered by 虚空终端] PS D:\Duckhome\CodeDebug> winget search DuckStudio -s winget
打开源时失败;如果问题仍然存在，请尝试"source reset"命令。
执行此命令时发生意外错误：
0x80070005 : 拒绝访问。
```
#### 解决方案
在管理员权限的终端中运行一些 WinGet 命令。  
```powershell
# 管理员权限的终端中
winget source update
winget search xxx -s winget
... # 任何 WinGet 命令，最好是有关源的
```

#### 为什么会出现这个问题
`%Temp%/WinGet` 目录被删除或当前用户对此文件夹没有权限。  

> 引用:  
> - [Can't install PowerToys using winget | microsoft/winget-cli#5439 (评论)](https://github.com/microsoft/winget-cli/issues/5439#issuecomment-2864911666)  
> - [Access Denied when %TEMP%\WinGet does not explicitly have the user with granted access | microsoft/winget-cli#5276](https://github.com/microsoft/winget-cli/issues/5276)  

### Installer hash does not match; this cannot be overridden when running as admin
- 如果您是使用者
  - 请向 [WinGet 软件包仓库](https://github.com/microsoft/winget-pkgs/issues/new?template=package_issue.yml) 提交错误  
- 如果您是在验证阶段看到此错误
  - 请见 [Error-Hash-Mismatch](#error-hash-mismatch)

## 软件包验证

### 一切内部 (Internal) 错误
一般情况下，您可以尝试**关闭并重新打开您的拉取请求**来重试验证管道。  

#### Internal-Error-NoSupportedArchitectures
这个内部错误**不能通过重试验证管道解决**，因为验证管道没有支持清单中的任意一个安装程序的架构的设备。当您的应用程序仅支持arm/arm64架构时会出现该错误。  

Microsoft 外部工作人员:  
> Unfortunately, we can only provide pipelines based on the OSes that the DaaS team makes available to us. Apparently, they don't currently have an arm nor arm64 OS.  
> 不幸的是，我们只能提供基于 DaaS 团队提供的操作系统的管道。显然，他们目前没有提供 arm 或 arm64 (架构的)操作系统。  
> <p style="text-align: right;">—— Stephen Gillie 2024 年 8 月 28 日</p>

> 引用:  
> - [[Package Request]: Add ARM64 Version of CPUID.CPU-Z | microsoft/winget-pkgs#135669 (评论)](https://github.com/microsoft/winget-pkgs/issues/135669#issuecomment-2313012616)  

#### Internal-Error-Dynamic-Scan / IEDS
如果您的应用程序中包含 Git 或将 Git 作为依赖项，则此错误无法通过重试验证管道解决。`Git.Git` 是目前已知的会出现此错误的软件包。  

Microsoft 外部工作人员:  
> Unfortunately, yes. Since Git is used by the pipeline VMs, installing it conflicts with validation, causing the IEDS label to be applied to the PR.  
> 不幸的是，是的。由于Git被管道虚拟机使用，安装它会与验证过程冲突，导致IEDS标签被应用到PR上。  
> <p style="text-align: right;">—— Stephen Gillie 2024 年 7 月 24 日</p>

> 引用:  
> [New version: GitTools.GitVersion version 6.0.0 | microsoft/winget-pkgs#164102 (评论)](https://github.com/microsoft/winget-pkgs/pull/164102#issuecomment-2248189203)  
> **[internal error dynamic scan | microsoft/winget-pkgs#155218](https://github.com/microsoft/winget-pkgs/discussions/155218)**  

#### Internal-Error-Static-Scan
这和 IEDS 类似，但此错误更可能是临时的（这个临时并不代表时间很短，某些 PR 可能在一个多月的尝试后才消除此错误）。  
这个错误不能通过手动验证解决。  

Microsoft 外部工作人员:  
> Oh - this is similar to the Internal-Error-Dynamic-Scan. The difference is that this is for the static analysis part of the scan - this means it hasn't progressed far enough through the pipeline for me to manually complete. It has to pass this stage, and the first part of the dynamic portion, before my automation can complete the process.  
> 哦 - 这与内部错误动态扫描 (IEDS) 类似。不同之处在于，这是针对扫描的静态分析部分 - 这意味着它还没有在管道中进展到足够的阶段，无法让我手动完成。它必须通过这一阶段，以及动态部分的第一部分，才能让我的自动化完成整个过程。  
> <p style="text-align: right;">—— Stephen Gillie 2025 年 6 月 9 日 (在 Gitter 上)</p>

### Installers Scan 阶段的错误

#### Binary-Validation-Error
目前没有办法解决这个错误。  

#### Error-Hash-Mismatch
**某个安装程序的哈希值不一致**，参阅验证管道输出了解具体是哪个安装程序。  
有些时候，WinGet 会将错误页面的 html 作为安装程序下载下来，进而导致此错误。如果下载的安装程序只有几 KB，则可能是此情况。请尝试使用 `winget download` 命令下载安装程序后通过记事本打开它看看到底是什么问题。  
如果清单中使用常青/虚 (vanity) URL，则在发布者发布新版本时会出现此错误。  

> 引用:  
> [[New Feature]: Automatically apply Get-FileHash to all packages | microsoft/winget-pkgs#264792](https://github.com/microsoft/winget-pkgs/issues/264792)  
> [[Update Request]: VLC | microsoft/winget-pkgs#213555](https://github.com/microsoft/winget-pkgs/issues/213555#issuecomment-2605255501)  

### Hardware
如果您的软件包需要特定硬件才能安装时会出现此错误。因为 WinGet 要求您的软件包必须能在所有设备上安装，所以 **WinGet 将拒绝这些软件包**。  

WinGet 产品经理:  
> At this time, we are not likely to look at purchasing custom hardware for the validation infrastructure. I'm closing this issue as "Not Planned", and as the Hardware label is added to PRs, they should still link to this issue.  
> 目前，我们不太可能考虑购买定制硬件用于验证基础设施。我将把这个问题关闭为“未计划”，并且由于硬件标签已添加到 PR 上，它们仍然应该与此问题关联。  
> <p style="text-align: right;">—— Demitrius Nelon 2024 年 12 月 18 日</p>

### 仅交互式软件包
**WinGet 目前不支持仅交互式软件包**，无论是仅交互式下载 (Interactive-Only-Download) 还是仅交互式安装 (Interactive-Only-Installer)。  
一些游戏（的启动器）并不支持静默安装，例如[原神旧版启动器](https://github.com/microsoft/winget-pkgs/issues/20435)、[原神外服](https://github.com/microsoft/winget-pkgs/pull/102719#discussion_r1169049925)、[伊瑟](https://github.com/microsoft/winget-pkgs/pull/265759#issuecomment-2971912300)等。  

> 引用:  
> [Support for filtering packages on installer method | microsoft/winget-cli#823](https://github.com/microsoft/winget-cli/issues/823)

## 社区
### 我不会英语怎么办
您可以尝试使用翻译软件翻译，或者直接使用中文讨论（如果您知道对方也说中文）。  
我知道的几个说中文的常贡献者:  
- [spectopo](https://github.com/spectopo) 的所有者 [Charlie Chen (SpecterShell)](https://github.com/SpecterShell)
- [❤是纱雾酱哟～ (Dragon1573)](https://github.com/Dragon1573)
- [智障派森 (coolplaylinbot)](https://github.com/coolplaylinbot) 的所有者 [CoolPlayLin (CoolPlayLin)](https://github.com/CoolPlayLin)
- [鸭鸭「カモ」(DuckDuckStudio)](https://github.com/DuckDuckStudio)
- [solomoncyj (solomoncyj)](https://github.com/solomoncyj)

### 我应该去哪里反馈问题
如果该问题涉及多个软件包，则请在 [microsoft/winget-cli](https://github.com/microsoft/winget-cli/issues/new/choose) 反馈。  
如果该问题仅涉及单个软件包，则请在 [microsoft/winget-pkgs](https://github.com/microsoft/winget-pkgs/issues/new/choose) 反馈。  

您**不应该**在 [Microsoft 社区](https://answers.microsoft.com/zh-hans) 寻求有关 WinGet 的帮助，这已经超出了他们的处理范围。  

### 反馈前我该做什么
在反馈问题前，请尝试在干净的系统（例如 [Windows 沙盒](https://learn.microsoft.com/zh-cn/windows/package-manager/winget/#install-winget-on-windows-sandbox)、新的 Hyper-V 虚拟机等）中**复现该问题**。  
如果成功复现，请将 WinGet 日志附加到议题中。你可以通过在命令中添加 `--logs` 参数来打开日志文件夹。  

如果是哈希错误，请尝试 [Error-Hash-Mismatch](#error-hash-mismatch) 中的验证。  
